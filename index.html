<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PromptFlow HP</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Fira+Mono&display=swap" rel="stylesheet">
<style>
:root{
Â --analyse:#00D9FF; --concevoir:#FFB400; --decider:#FF4081;
Â --creer:#8A2BE2;Â  --ameliorer:#32CD32; --bg:#1B365D; --bg2:#16202a;
Â --text:#E6E6E6;Â  --text-dim:#9BA3AF; --radius:14px;
}
body{margin:0;display:flex;height:100vh;font-family:Inter,Arial,sans-serif;
Â background:var(--bg);color:var(--text);}
button,input,select,textarea{font-family:inherit}
.sidebar{width:68px;background:#0E151D;display:flex;flex-direction:column;
Â align-items:center;padding:10px 0;gap:14px}
.icon-btn{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;
Â justify-content:center;font-size:25px;cursor:pointer;border:none;background:transparent;
Â transition:transform .15s,box-shadow .15s}
.icon-btn.active{transform:scale(1.15);box-shadow:0 0 0 3px var(--text-dim)}
.icon-btn:focus-visible{outline:2px solid var(--text)}
.main{flex:1;padding:22px 18px 80px 18px;overflow-y:auto}
h1{margin:0 0 14px;font-size:1.6rem}
.topbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.select{background:var(--bg2);border:none;border-radius:var(--radius);padding:8px 12px;
Â color:var(--text);font-size:1rem;}
.search{flex:1;min-width:180px;background:#0F1C27;border:none;border-radius:var(--radius);
Â padding:8px 12px;color:var(--text);font-size:1rem;}
.search::placeholder{color:#6B7280}
#promptCount{font-size:.9rem;color:var(--text-dim)}
#promptList{list-style:none;padding:0;margin:18px 0}
.prompt{background:var(--bg2);padding:14px;border-left:6px solid var(--analyse);
Â border-radius:var(--radius);margin-bottom:12px;display:flex;justify-content:space-between;gap:10px}
.prompt-main{flex:1;min-width:0}
.p-title{font-weight:600;margin-bottom:4px;word-break:break-word}
.p-tags{font-size:.85rem;color:#00BDA4;margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.p-body{font-size:.95rem;line-height:1.4;white-space:pre-line;max-height:5.6em;overflow:hidden}
.p-actions{display:flex;flex-direction:column;gap:6px}
.icon{border:none;background:#243041;color:var(--text);border-radius:8px;width:38px;height:38px;
Â display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer}
.icon:hover{background:#008EAA}
.icon:focus-visible{outline:2px solid var(--text)}
#fab{position:fixed;right:20px;bottom:20px;background:linear-gradient(90deg,#008EAA,#00D9FF);
Â border:none;border-radius:40px;padding:14px 28px;font-weight:700;font-size:1rem;color:#001;
Â box-shadow:0 4px 20px #00d9ff70;cursor:pointer;z-index:5}
#fab:focus-visible{outline:2px solid var(--text)}
.overlay{position:fixed;inset:0;background:#0008;display:none;align-items:center;justify-content:center;z-index:10}
.modal{background:#0F1C27;border-radius:var(--radius);padding:24px;width:95%;max-width:420px;
Â color:var(--text);display:flex;flex-direction:column;gap:10px;max-height:92vh;overflow:auto}
.modal input,.modal textarea,.modal select{background:#09131C;border:none;border-radius:var(--radius);
Â color:var(--text);padding:9px 11px;font-size:1rem}
.modal textarea{min-height:90px}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
.btn{border:none;border-radius:var(--radius);padding:9px 16px;font-weight:600;font-size:1rem;cursor:pointer}
.btn-primary{background:var(--ameliorer);color:#05110B}
.btn-secondary{background:#374151;color:var(--text)}
.toast{position:fixed;bottom:24px;right:24px;min-width:160px;background:#111820;
Â color:var(--text);padding:12px 16px;border-radius:var(--radius);opacity:0;pointer-events:none;
Â transition:opacity .3s;z-index:20}
#apiKeyModal label{margin-bottom:8px}
#apiKeyInp{font-family:'Fira Mono',monospace;}
.api-key-status{font-size:.93em;margin-top:-5px;margin-bottom:8px;}
.api-key-ok{color:#32CD32;}
.api-key-bad{color:#FF4081;}
@media (max-width:580px){
Â .sidebar{display:none}
Â .main{padding-left:10px;padding-right:10px}
}
</style>
</head>
<body>
<nav class="sidebar" id="sidebar" aria-label="Sens Homo Promptus"></nav>
<main class="main">
Â <div class="topbar">
Â  Â <h1 id="mainTitle" style="margin-right:auto">Analyse</h1>
Â  Â <select id="actionSelect" class="select" aria-label="SÃ©lectionner une action"></select>
Â  Â <span id="promptCount"></span>
Â  Â <input id="search" class="search" type="search" placeholder="Rechercherâ€¦ ( / )" aria-label="Recherche">
Â  Â <button id="apiKeyBtn" class="icon-btn" style="background:#2d3843;font-size:18px;margin-left:7px" title="Configurer la clÃ© OpenAI" aria-label="Configurer la clÃ© API OpenAI">ğŸ”‘</button>
Â </div>
Â <ul id="promptList"></ul>
Â  Â  <button id="exportBtn" class="btn btn-secondary"
Â  Â  Â  Â  Â  style="position:fixed;bottom:100px;right:20px;">Exporter</button>
Â  <button id="importBtn" class="btn btn-secondary"
Â  Â  Â  Â  Â  style="position:fixed;bottom:140px;right:20px;">Importer</button>
Â  <input type="file" id="importInput" accept=".json" style="display:none">
</main>
<button id="fab" aria-label="Ajouter un prompt">+ Prompt</button>
<div class="overlay" id="modalOv">
Â <form class="modal" id="editModal" autocomplete="off">
Â  Â <label>Famille (Sens)
Â  Â  Â <select id="senseSel" required></select>
Â  Â </label>
Â  Â <label>Action
Â  Â  Â <select id="actionSel" required></select>
Â  Â </label>
Â  Â <label>Titre
Â  Â  Â <input id="titleInp" placeholder="Titre du prompt" required>
Â  Â </label>
Â  Â <label>Tags (virgule)
Â  Â  Â <input id="tagsInp" placeholder="tag1, tag2">
Â  Â </label>
Â  Â <label>Prompt
Â  Â  Â <textarea id="promptInp" placeholder="Colle ton prompt iciâ€¦" required></textarea>
Â  Â </label>
Â  Â <div class="actions">
Â  Â  Â <button type="submit" class="btn btn-primary">Enregistrer</button>
Â  Â  Â <button type="button" class="btn btn-secondary" data-close>Annuler</button>
Â  Â </div>
Â </form>
</div>
<div class="overlay" id="sandboxOv">
Â <div class="modal" id="sandboxModal" role="dialog" aria-modal="true">
Â  Â <h3 style="margin:0">Test du prompt (OpenAI)</h3>
Â  Â <div id="sandboxLoader" style="display:none;color:#00D9FF;font-size:1.2em">â³ GÃ©nÃ©rationâ€¦</div>
Â  Â <pre id="sandboxOut" style="font-family:'Fira Mono',monospace;background:#09131C;
Â  Â  Â padding:12px;border-radius:var(--radius);white-space:pre-wrap"></pre>
Â  Â <div class="actions">
Â  Â  Â <button class="btn btn-secondary" data-close>Fermer</button>
Â  Â </div>
Â </div>
</div>
<div class="overlay" id="apiKeyOv">
Â <form class="modal" id="apiKeyModal" style="gap:12px" autocomplete="off">
Â  Â <label for="apiKeyInp">ClÃ© API OpenAI
Â  Â  <input id="apiKeyInp" type="password" placeholder="sk-..." autocomplete="off" spellcheck="false" style="margin-top:7px" required>
Â  Â </label>
Â  Â <div class="api-key-status" id="apiKeyStatus"></div>
Â  Â <div class="actions">
Â  Â  <button type="submit" class="btn btn-primary">Enregistrer</button>
Â  Â  <button type="button" class="btn btn-secondary" data-close>Annuler</button>
Â  Â </div>
Â  Â <div style="font-size:.93em;color:#9BA3AF">La clÃ© nâ€™est <b>jamais envoyÃ©e</b> ailleurs que chez OpenAI.<br>StockÃ©e dans ton navigateur uniquement.</div>
Â </form>
</div>
<div class="toast" id="toast"></div>
<script>
const HP = {
Â senses:[
Â  {id:'analyse', label:'Analyse', emoji:'ğŸ§', color:'var(--analyse)',
Â  Â actions:['Concurrence','MarchÃ©','KPI','Docs','PrÃ©-RDV','Risques']},
Â  {id:'concevoir',label:'Concevoir',emoji:'ğŸ§©',color:'var(--concevoir)',
Â  Â actions:['Workflow','Plan projet','Offre','PÃ©dagogie','Storyboard']},
Â  {id:'decider',label:'DÃ©cider',emoji:'âš–ï¸',color:'var(--decider)',
Â  Â actions:['PrioritÃ©s','Choix strat.','Risques','Pricing','Roadmap']},
Â  {id:'creer',label:'CrÃ©er',emoji:'ğŸ¨',color:'var(--creer)',
Â  Â actions:['Copy','Scripts','Visuels','IdÃ©ation','Storytelling']},
Â  {id:'ameliorer',label:'AmÃ©liorer',emoji:'ğŸ”§',color:'var(--ameliorer)',
Â  Â actions:['Relecture','Process','KPI','UX','Argumentaire']}
Â ]
};
const lsKey='hp_prompts_v4'; const stateKey='hp_state_v1'; const apiKeyKey='hp_apikey_v1';
const Store={
Â get(){return JSON.parse(localStorage.getItem(lsKey)||'[]')},
Â set(arr){localStorage.setItem(lsKey,JSON.stringify(arr))},
Â getState(){return JSON.parse(localStorage.getItem(stateKey)||'{}')},
Â setState(obj){localStorage.setItem(stateKey,JSON.stringify(obj))},
Â getAPI(){return localStorage.getItem(apiKeyKey)||''},
Â setAPI(key){localStorage.setItem(apiKeyKey,key)},
Â clearAPI(){localStorage.removeItem(apiKeyKey)}
};
let prompts=Store.get(); let uiState={...{sense:0,action:0},...Store.getState()};
const sidebar=$('#sidebar'); const actionSelect=$('#actionSelect');
const promptList=$('#promptList'); const mainTitle=$('#mainTitle');
const countEl=$('#promptCount'); const searchInput=$('#search');
const fab=$('#fab'); const toastEl=$('#toast');
const modalOv=$('#modalOv'); const editForm=$('#editModal');
const senseSel=$('#senseSel'); const actionSel=$('#actionSel');
const titleInp=$('#titleInp'); const tagsInp=$('#tagsInp'); const promptInp=$('#promptInp');
const sandboxOv=$('#sandboxOv'); const sandboxOut=$('#sandboxOut');
const sandboxLoader=$('#sandboxLoader');
const apiKeyOv=$('#apiKeyOv'); const apiKeyModal=$('#apiKeyModal'); const apiKeyInp=$('#apiKeyInp');
const apiKeyStatus=$('#apiKeyStatus'); const apiKeyBtn=$('#apiKeyBtn');
function $(sel){return document.querySelector(sel);}
function toast(msg){
Â toastEl.textContent=msg; toastEl.style.opacity=1;
Â setTimeout(()=>toastEl.style.opacity=0,2500);
}
function escHtml(str){return str.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;', '"':'&quot;',"'":'&#039;'}[m]));}
// Sidebar : crÃ©ation dynamique
sidebar.innerHTML = ""; // sÃ©curitÃ© si multi-init
HP.senses.forEach((s,i)=>{
Â const btn=document.createElement('button');
Â btn.className='icon-btn'; btn.innerHTML=`<span role="img" aria-label="${s.label}">${s.emoji}</span>`;
Â btn.style.background=s.color; btn.onclick=()=>selectSense(i);
Â btn.addEventListener('keydown',e=>{if(e.key==='ArrowRight')selectSense((i+1)%5); if(e.key==='ArrowLeft')selectSense((i+4)%5)});
Â sidebar.appendChild(btn);
});
function selectSense(idx){
Â uiState.sense=idx; actionSelectFill(); render();
Â [...sidebar.children].forEach((b,i)=>b.classList.toggle('active',i===idx));
Â Store.setState(uiState);
}
function actionSelectFill(){
Â actionSelect.innerHTML='';
Â HP.senses[uiState.sense].actions.forEach((a,i)=>{
Â  const opt=document.createElement('option'); opt.value=i; opt.textContent=a;
Â  actionSelect.appendChild(opt);
Â });
Â actionSelect.selectedIndex=uiState.action=0;
}
actionSelect.onchange=e=>{uiState.action=e.target.selectedIndex; Store.setState(uiState); render();}
function render(){
Â mainTitle.textContent=HP.senses[uiState.sense].label;
Â const filter=searchInput.value.trim().toLowerCase();
Â const curSense=HP.senses[uiState.sense].id;
Â const curAction=HP.senses[uiState.sense].actions[uiState.action];
Â const list=prompts.filter(p=>p.sense===curSense&&p.action===curAction
Â  &&(p.title.toLowerCase().includes(filter)||p.tags.toLowerCase().includes(filter)||p.prompt.toLowerCase().includes(filter)));
Â countEl.textContent=`${list.length} prompt${list.length>1?'s':''}`;
Â promptList.innerHTML='';
Â list.forEach((p,idx)=>{
Â  const li=document.createElement('li'); li.className='prompt';
Â  li.style.borderColor=`var(--${p.sense})`;
Â  li.innerHTML=`
Â  Â <div class="prompt-main">
Â  Â  Â <div class="p-title">${escHtml(p.title)}</div>
Â  Â  Â <div class="p-tags">${escHtml(p.tags)}</div>
Â  Â  Â <div class="p-body">${escHtml(p.prompt)}</div>
Â  Â </div>
Â  Â <div class="p-actions">
Â  Â  Â <button class="icon" aria-label="Ã‰diter" onclick="editPrompt(${prompts.indexOf(p)})">âœï¸</button>
Â  Â  Â <button class="icon" aria-label="Supprimer" onclick="delPrompt(${prompts.indexOf(p)})">ğŸ—‘ï¸</button>
Â  Â  Â <button class="icon" aria-label="Copier" onclick="copyPrompt(${prompts.indexOf(p)})">ğŸ“‹</button>
Â  Â  Â <button class="icon" aria-label="Test (mock)" onclick="testPrompt(${prompts.indexOf(p)},false)">ğŸ§ª</button>
Â  Â  Â <button class="icon" aria-label="Test LLM" onclick="testPrompt(${prompts.indexOf(p)},true)">ğŸ¤–</button>
Â  Â </div>`;
Â  promptList.appendChild(li);
Â });
}
document.addEventListener('keydown',e=>{
Â if(e.key==='/' && document.activeElement!==searchInput){e.preventDefault();searchInput.focus();}
Â if(e.key==='n' && !modalOv.open && !sandboxOv.open){openModal();}
});
searchInput.oninput=render;
window.editPrompt=i=>openModal(prompts[i],i);
window.delPrompt=i=>{if(confirm('Supprimer ?')){prompts.splice(i,1);Store.set(prompts);toast('SupprimÃ©');render();}};
window.copyPrompt=i=>navigator.clipboard.writeText(prompts[i].prompt).then(()=>toast('CopiÃ©'));
window.testPrompt=(i,llm)=>{
Â sandboxLoader.style.display=llm?'block':'none';
Â sandboxOut.textContent=llm?'':'[Simulation]\n\n'+prompts[i].prompt.slice(0,600)+'\n\n[RÃ©ponse simulÃ©e LLM]';
Â openOverlay(sandboxOv);
Â if(llm) testPromptWithOpenAI(prompts[i].prompt);
};
fab.onclick = () => {
Â  // Garantit lâ€™ouverture de la modale crÃ©ation prompt avec sens/action courants
Â  openModal({
Â  Â  sense: HP.senses[uiState.sense].id,
Â  Â  action: HP.senses[uiState.sense].actions[uiState.action],
Â  Â  title: "",
Â  Â  tags: "",
Â  Â  prompt: ""
Â  }, null);
};
function openModal(p = {
Â  sense: HP.senses[0].id,
Â  action: HP.senses[0].actions[0],
Â  title: '',
Â  tags: '',
Â  prompt: ''
}, idx = null) {
Â  editForm.dataset.idx = idx;
Â  senseSel.innerHTML = '';
Â  HP.senses.forEach(s=>{
Â  Â  const o=document.createElement('option');
Â  Â  o.value=s.id; o.textContent=s.label;
Â  Â  if(s.id===p.sense) o.selected=true;
Â  Â  senseSel.appendChild(o);
Â  });
Â  actionSel.innerHTML='';
Â  const actList = HP.senses.find(s=>s.id===p.sense).actions;
Â  actList.forEach(a=>{
Â  Â  const o=document.createElement('option');
Â  Â  o.value=a; o.textContent=a;
Â  Â  if(a===p.action) o.selected=true;
Â  Â  actionSel.appendChild(o);
Â  });
Â  titleInp.value = p.title || "";
Â  tagsInp.value = p.tags || "";
Â  promptInp.value = p.prompt || "";
Â  openOverlay(modalOv);
Â  setTimeout(() => { titleInp.focus(); }, 80);
}
senseSel.onchange=()=>{
Â  actionSel.innerHTML='';
Â  const acts = HP.senses.find(s=>s.id===senseSel.value).actions;
Â  acts.forEach(a=>{
Â  Â  const o=document.createElement('option');o.value=a;o.textContent=a;actionSel.appendChild(o);
Â  });
};
editForm.onsubmit=e=>{
Â e.preventDefault();
Â const idx=editForm.dataset.idx;
Â const obj={sense:senseSel.value,action:actionSel.value,
Â  title:titleInp.value.trim(),tags:tagsInp.value.trim(),prompt:promptInp.value.trim()};
Â if(idx==='null'||idx===null)prompts.unshift(obj); else prompts[idx]=obj;
Â Store.set(prompts);toast('EnregistrÃ©');closeOverlay(modalOv);render();
};
function openOverlay(ov){ov.style.display='flex';ov.open=true;
Â ov.querySelector('[data-close]')?.focus();}
function closeOverlay(ov){ov.style.display='none';ov.open=false;}
document.body.addEventListener('click',e=>{
Â if(e.target.matches('[data-close]'))closeOverlay(e.target.closest('.overlay'));
  // MODIFICATION ICI: Ne ferme l'overlay que si ce n'est PAS l'overlay de la modale d'Ã©dition de prompt (modalOv).
Â if(e.target.classList.contains('overlay') && e.target.id !== 'modalOv')closeOverlay(e.target);
});
document.addEventListener('keydown',e=>{
Â if(e.key==='Escape'){[modalOv,sandboxOv,apiKeyOv].forEach(o=>o.open&&closeOverlay(o));}
});
actionSelectFill(); selectSense(uiState.sense); render();
/* API KEY MODAL */
apiKeyBtn.onclick=()=>{apiKeyStatus.textContent='';apiKeyInp.value=Store.getAPI()||'';openOverlay(apiKeyOv);apiKeyInp.focus();};
apiKeyModal.onsubmit=async e=>{
Â e.preventDefault();
Â const k=apiKeyInp.value.trim();
Â if(!/^sk-[A-Za-z0-9]{20,}/.test(k)){apiKeyStatus.textContent="ClÃ© invalide";apiKeyStatus.className="api-key-status api-key-bad";return;}
Â apiKeyStatus.textContent='Test clÃ©â€¦';apiKeyStatus.className="api-key-status";
Â try{
Â  Â await testApiKeyOpenAI(k);
Â  Â Store.setAPI(k);apiKeyStatus.textContent="ClÃ© validÃ©e !";apiKeyStatus.className="api-key-status api-key-ok";
Â  Â setTimeout(()=>{closeOverlay(apiKeyOv);toast("ClÃ© OpenAI sauvegardÃ©e")},800);
Â }catch{
Â  Â apiKeyStatus.textContent="ClÃ© refusÃ©e par OpenAI";apiKeyStatus.className="api-key-status api-key-bad";
Â }
};
window.testPromptWithOpenAI=async function(prompt){
Â const key=Store.getAPI();
Â if(!key){closeOverlay(sandboxOv);openOverlay(apiKeyOv);apiKeyInp.focus();toast("Configure ta clÃ© OpenAI");return;}
Â sandboxLoader.style.display='block';
Â try{
Â  const body={model:"gpt-4o",messages:[{role:"user",content:prompt}],max_tokens:400,temperature:0.7};
Â  const res=await fetch("https://api.openai.com/v1/chat/completions",{
Â  Â method:"POST",headers:{"Authorization":"Bearer "+key,"Content-Type":"application/json"},
Â  Â body:JSON.stringify(body)
Â  });
Â  if(!res.ok) throw new Error("API refuse");
Â  const data=await res.json();
Â  let rep=(data.choices?.[0]?.message?.content)||"(RÃ©ponse vide)";
Â  sandboxOut.textContent=rep.trim();
Â }catch(e){
Â  sandboxOut.textContent="âŒ Erreur OpenAI : "+e;
Â }finally{sandboxLoader.style.display='none';}
};
window.testApiKeyOpenAI=async function(k){
Â const body={model:"gpt-3.5-turbo",messages:[{role:"user",content:"Hello!"}],max_tokens:2,temperature:0.1};
Â const res=await fetch("https://api.openai.com/v1/chat/completions",{
Â  method:"POST",headers:{"Authorization":"Bearer "+k,"Content-Type":"application/json"},
Â  body:JSON.stringify(body)
Â });
Â if(!res.ok) throw new Error("ClÃ© refusÃ©e");
Â await res.json();
};
// ===== Exporter la base au format JSON =====
const exportBtn = document.getElementById('exportBtn');
exportBtn.addEventListener('click', () => {
Â  const data = JSON.stringify(prompts, null, 2);
Â  const blob = new Blob([data], { type: 'application/json' });
Â  const urlÂ  = URL.createObjectURL(blob);
Â  const aÂ  Â  = document.createElement('a');
Â  a.hrefÂ  Â  Â = url;
Â  a.download = 'promptflow_prompts.json';
Â  a.click();
Â  URL.revokeObjectURL(url);
Â  toast('Export terminÃ© ! ğŸ‰');
});

// ===== Importer depuis un fichier JSON =====
const importBtnÂ  Â = document.getElementById('importBtn');
const importInput = document.getElementById('importInput');

importBtn.addEventListener('click', () => importInput.click());

importInput.addEventListener('change', (e) => {
Â  const file = e.target.files[0];
Â  if (!file) return;
Â  const reader = new FileReader();
Â  reader.onload = () => {
Â  Â  try {
Â  Â  Â  const imported = JSON.parse(reader.result);
Â  Â  Â  if (!Array.isArray(imported)) throw new Error('Format invalide');
Â  Â  Â  prompts = imported;Â  Â  Â  Â  Â  Â  Â // on remplace tout
Â  Â  Â  Store.set(prompts);Â  Â  Â  Â  Â  Â  Â // on sauvegarde
Â  Â  Â  render();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // on rafraÃ®chit lâ€™affichage
Â  Â  Â  toast('Import rÃ©ussi ! ğŸš€');
Â  Â  } catch (err) {
Â  Â  Â  console.error(err);
Â  Â  Â  toast('Erreur dâ€™import : fichier invalide âŒ');
Â  Â  }
Â  };
Â  reader.readAsText(file);
});
</script>
</body>
</html>
