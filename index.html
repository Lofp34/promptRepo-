<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>PromptFlow HP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --analyse:#00D9FF;
  --concevoir:#FFB400;
  --decider:#FF4081;
  --creer:#8A2BE2;
  --ameliorer:#32CD32;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',Arial,sans-serif}
body{display:flex;height:100vh;background:#1B365D;color:#fff}
.sidebar{width:72px;background:#121921;display:flex;flex-direction:column;align-items:center;padding:10px 0;gap:14px}
.side-btn{width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;transition:transform .15s}
.side-btn.active{transform:scale(1.15)}
.main{flex:1;padding:24px;overflow-y:auto}
h1{font-size:1.8em;margin-bottom:10px}
.action-select{margin:6px 0 16px 0;padding:8px 12px;font-size:1em;border-radius:8px;border:none;background:#243041;color:#fff}
#promptList{list-style:none}
.prompt-item{background:#16202a;padding:16px;border-left:6px solid var(--analyse);border-radius:12px;margin-bottom:14px;box-shadow:0 2px 10px #0005;display:flex;justify-content:space-between;gap:12px}
.prompt-main{flex:1}
.prompt-title{font-weight:600;margin-bottom:4px}
.prompt-tags{font-size:.85em;color:#00BDA4;margin-bottom:6px}
.prompt-actions{display:flex;flex-direction:column;gap:6px}
.prompt-actions button{border:none;background:#243041;padding:6px 10px;border-radius:6px;color:#fff;font-size:1em;cursor:pointer}
.prompt-actions button:hover{background:#008EAA}
#addPromptBtn{position:fixed;right:24px;bottom:24px;background:linear-gradient(90deg,#008EAA,#00D9FF);border:none;border-radius:32px;padding:14px 26px;color:#000;font-weight:700;font-size:1.1em;cursor:pointer;box-shadow:0 4px 20px #00d9ff66}
.modal-bg{position:fixed;inset:0;background:#0008;display:none;align-items:center;justify-content:center;z-index:10}
.modal{background:#1e2733;width:95%;max-width:420px;padding:24px;border-radius:16px;display:flex;flex-direction:column;gap:10px}
.modal label{font-size:.95em}
.modal input,.modal textarea,.modal select{width:100%;padding:8px 10px;border:none;border-radius:6px;background:#111820;color:#fff;font-size:1em}
.modal textarea{min-height:84px;resize:vertical}
.modal .actions{margin-top:8px;display:flex;gap:8px;justify-content:flex-end}
.modal .actions button{padding:8px 16px;border-radius:6px;border:none;font-weight:600;cursor:pointer}
.save{background:#32CD32;color:#000}
.cancel{background:#444;color:#fff}
@media(max-width:700px){.sidebar{width:60px}.side-btn{font-size:22px;height:48px;width:48px}}
</style>
</head>
<body>
 <!--‚Ää~~~~~~~~  SIDEBAR  ~~~~~~~~-->
 <nav class="sidebar" id="sidebar"></nav>

 <!--‚Ää~~~~~~~~  MAIN  ~~~~~~~~-->
 <main class="main">
   <h1 id="mainTitle">Analyse</h1>
   <select id="actionSelect" class="action-select"></select>
   <ul id="promptList"></ul>
 </main>

 <!--‚Ää~~~~~~~~  ADD / EDIT MODAL  ~~~~~~~~-->
 <div class="modal-bg" id="modalBg">
  <div class="modal">
    <label>Sens</label>
    <select id="senseSel"></select>
    <label>Action</label>
    <select id="actionSel"></select>
    <label>Titre</label>
    <input id="titleInp" placeholder="Titre">
    <label>Tags (virgule)</label>
    <input id="tagsInp" placeholder="tag1, tag2">
    <label>Prompt</label>
    <textarea id="promptInp" placeholder="Copie ton prompt‚Ä¶"></textarea>
    <div class="actions">
      <button class="save" id="saveBtn">Enregistrer</button>
      <button class="cancel" id="cancelBtn">Annuler</button>
    </div>
  </div>
 </div>

 <!--‚Ää~~~~~~~~  SANDBOX MODAL  ~~~~~~~~-->
 <div class="modal-bg" id="sandboxBg">
  <div class="modal">
    <div style="color:#FFA500;font-weight:600">Test du prompt (mock)</div>
    <div id="sandboxOutput" style="white-space:pre-wrap;background:#111820;padding:10px;border-radius:6px;margin:8px 0"></div>
    <div class="actions"><button class="cancel" id="closeSandbox">Fermer</button></div>
  </div>
 </div>

 <button id="addPromptBtn">+ Prompt</button>

<script>
/* === DATA MODEL ==================================== */
const HP = {
  senses:[
    {id:'analyse',  label:'Analyse',  emoji:'üßê', color:'var(--analyse)',
     actions:['Concurrence','March√©','KPI','Docs','Pr√©-RDV','Risques']},
    {id:'concevoir',label:'Concevoir',emoji:'üß©',color:'var(--concevoir)',
     actions:['Workflow','Plan projet','Offre','P√©dagogie','Storyboard']},
    {id:'decider',  label:'D√©cider',  emoji:'‚öñÔ∏è', color:'var(--decider)',
     actions:['Priorit√©s','Choix strat.','Risques','Pricing','Roadmap']},
    {id:'creer',    label:'Cr√©er',    emoji:'üé®', color:'var(--creer)',
     actions:['Copy','Scripts','Visuels','Id√©ation','Storytelling']},
    {id:'ameliorer',label:'Am√©liorer',emoji:'üîß', color:'var(--ameliorer)',
     actions:['Relecture','Process','KPI','UX','Argumentaire']}
  ]
};

/* === STORAGE ======================================== */
function loadPrompts(){return JSON.parse(localStorage.getItem('hp_prompts')||'[]')}
function savePrompts(list){localStorage.setItem('hp_prompts',JSON.stringify(list))}
let prompts=loadPrompts(); let editIdx=null;

/* === UI INIT ======================================== */
const sidebar=document.getElementById('sidebar');
HP.senses.forEach((s,i)=>{
  const btn=document.createElement('div');
  btn.className='side-btn';btn.innerHTML=s.emoji;btn.style.background=s.color;
  btn.onclick=()=>selectSense(i); sidebar.appendChild(btn)
});
let currentSense=0;
const actionSelect=document.getElementById('actionSelect');
function fillActions(idx){
  actionSelect.innerHTML='';
  HP.senses[idx].actions.forEach(a=>{
    const opt=document.createElement('option');opt.value=a;opt.textContent=a;actionSelect.appendChild(opt);
  });
}

/* === RENDER PROMPTS ================================= */
const promptList=document.getElementById('promptList');
function renderPrompts(){
  promptList.innerHTML='';
  const act=actionSelect.value;
  prompts.filter(p=>p.sense===HP.senses[currentSense].id && p.action===act)
  .forEach((p,i)=>{
    const li=document.createElement('li');li.className='prompt-item';
    li.style.borderColor=`var(--${p.sense})`;
    li.innerHTML=`
      <div class="prompt-main">
        <div class="prompt-title">${p.title||'(Sans titre)'}</div>
        <div class="prompt-tags">${p.tags}</div>
        <div>${p.prompt.replace(/\n/g,'<br>')}</div>
      </div>
      <div class="prompt-actions">
        <button onclick="editPrompt(${i})">‚úèÔ∏è</button>
        <button onclick="delPrompt(${i})">üóëÔ∏è</button>
        <button onclick="copyPrompt(${i})">üìã</button>
        <button onclick="testPrompt(${i})">üß™</button>
      </div>`;
    promptList.appendChild(li);
  });
}

/* === SENSE SWITCH ===================================*/
function selectSense(idx){
  currentSense=idx;
  [...sidebar.children].forEach((b,i)=>b.classList.toggle('active',i===idx));
  document.getElementById('mainTitle').textContent=HP.senses[idx].label;
  fillActions(idx); renderPrompts();
}
actionSelect.onchange=renderPrompts;
selectSense(0); // init first

/* === ADD / EDIT PROMPT ==============================*/
const modalBg=document.getElementById('modalBg');
document.getElementById('addPromptBtn').onclick=()=>openModal();
document.getElementById('cancelBtn').onclick=()=>modalBg.style.display='none';
document.getElementById('saveBtn').onclick=saveModal;
const senseSel=document.getElementById('senseSel');
HP.senses.forEach(s=>{
  const o=document.createElement('option');o.value=s.id;o.textContent=s.label;senseSel.appendChild(o);
});
const actionSel=document.getElementById('actionSel');
senseSel.onchange=()=>{actionSel.innerHTML='';HP.senses.find(s=>s.id===senseSel.value).actions.forEach(a=>{
  const o=document.createElement('option');o.value=a;o.textContent=a;actionSel.appendChild(o);
});};

function openModal(p={sense:HP.senses[currentSense].id,action:HP.senses[currentSense].actions[0],title:'',tags:'',prompt:''},idx=null){
  editIdx=idx;senseSel.value=p.sense;senseSel.onchange();actionSel.value=p.action;
  titleInp.value=p.title;tagsInp.value=p.tags;promptInp.value=p.prompt;
  modalBg.style.display='flex';
}

function saveModal(){
  const obj={sense:senseSel.value,action:actionSel.value,title:titleInp.value.trim(),tags:tagsInp.value.trim(),prompt:promptInp.value.trim()};
  if(!obj.prompt)return alert('Le prompt est vide');
  if(editIdx!==null)prompts[editIdx]=obj;else prompts.unshift(obj);
  savePrompts(prompts);modalBg.style.display='none';renderPrompts();
}

/* === PROMPT OPS =====================================*/
window.editPrompt=i=>openModal(prompts[i],i);
window.delPrompt=i=>{if(confirm('Supprimer ?')){prompts.splice(i,1);savePrompts(prompts);renderPrompts();}};
window.copyPrompt=i=>navigator.clipboard.writeText(prompts[i].prompt).then(()=>alert('Copi√© !'));
/* mock test */
const sandboxBg=document.getElementById('sandboxBg');const sandboxOutput=document.getElementById('sandboxOutput');
window.testPrompt=i=>{sandboxOutput.textContent=`[Simulation]\nPrompt: ${prompts[i].prompt.slice(0,180)}...`;sandboxBg.style.display='flex';};
document.getElementById('closeSandbox').onclick=()=>sandboxBg.style.display='none';

/* click outside modal */
[modalBg,sandboxBg].forEach(bg=>bg.onclick=e=>{if(e.target===bg)bg.style.display='none';});
</script>
</body>
</html>